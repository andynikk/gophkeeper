## [**Gophkeeper**](https://github.com/andynikk/gophkeeper)

---

1.  Сервер запускается с флагами -a адрес сервера -d строка соединения с базой

**Пример**: _go run main.go -a localhost:8050 -d postgresql://postgres:postgres@localhost:5432/yapracticum_

или **параметры сеанса**: _ADDRESS и CRYPTO\_KEY_

1.  Клиент запускается с флагами -a адрес сервера -c файл с криптоключем

**Пример**: _go run main.go -a localhost:8080 -c e:\\Bases\\key\\gophkeeper.xor_

или **параметры сеанса**: _ADDRESS и DATABASE\_URI_

![](https://33333.cdn.cke-cs.com/kSW7V9NHUXugvhoQeFaf/images/12d58ea9f17103acacda7080e3314d30351ccfd98a290de3.jpg)

##### 1\. При запуске клиента создается websocket между клиентом и сервером. Одна горутина спамит текущий токен на сервер.

##### 2\. Если токен валиден, то сервер собирает всю информацию по пользователям и в бесконечном цикле отсылает их, по созданному websocket, на клиент.

##### 3\. Клиент, второй горутиной, получает всю инфу с сервера и складывает в свое хранилище в памяти. Происходит автоматическое обновление информации по пользователю клиента. Которую можно отобразить или посчитать.

##### 4\. При вызове API клиент, через хендлеры кладет данные в хранилище на сервере.

##### 5\. Горутина сервера в бесконечном цикле читает свое хранилище и кладет данные в базу, очищая свое хранилище.

##### 6\. Файлы с клиента выгружаются на сервер отдельным websocket. 6.1. На клиенте создается websocket. 6.2. Выбранный файл, режется на части по 512Кб отдельной горутиной. Шифруются, упаковываются в gzip. И каждая часть посылается на сервер с меткой с какого байта начинается часть. Части сразу кладутся в БД, без помещения в хранилище сервера.

##### 7\. При загрузке файла на клиент. Отбираются части файла из БД по УИДу. Создается websocket. И по websocket данные передаются на клиент. Где из кусочков собирается файл на диске.
